(self["webpackChunktaxonium"] = self["webpackChunktaxonium"] || []).push([["node_modules_jbrowse_plugin-wiggle_esm_BigWigAdapter_BigWigAdapter_js"],{

/***/ "./node_modules/@jbrowse/plugin-wiggle/esm/BigWigAdapter/BigWigAdapter.js":
/*!********************************************************************************!*\
  !*** ./node_modules/@jbrowse/plugin-wiggle/esm/BigWigAdapter/BigWigAdapter.js ***!
  \********************************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": function() { return /* binding */ BigWigAdapter; }
/* harmony export */ });
/* harmony import */ var _gmod_bbi__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @gmod/bbi */ "./node_modules/@gmod/bbi/esm/index.js");
/* harmony import */ var _jbrowse_core_data_adapters_BaseAdapter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @jbrowse/core/data_adapters/BaseAdapter */ "./node_modules/@jbrowse/core/data_adapters/BaseAdapter.js");
/* harmony import */ var _jbrowse_core_data_adapters_BaseAdapter__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_jbrowse_core_data_adapters_BaseAdapter__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _jbrowse_core_util_io__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @jbrowse/core/util/io */ "./node_modules/@jbrowse/core/util/io/index.js");
/* harmony import */ var _jbrowse_core_util_io__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_jbrowse_core_util_io__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _jbrowse_core_util__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @jbrowse/core/util */ "./node_modules/@jbrowse/core/util/index.js");
/* harmony import */ var _jbrowse_core_util__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_jbrowse_core_util__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _jbrowse_core_util_rxjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @jbrowse/core/util/rxjs */ "./node_modules/@jbrowse/core/util/rxjs.js");
/* harmony import */ var _jbrowse_core_util_stats__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @jbrowse/core/util/stats */ "./node_modules/@jbrowse/core/util/stats.js");






class BigWigAdapter extends _jbrowse_core_data_adapters_BaseAdapter__WEBPACK_IMPORTED_MODULE_1__.BaseFeatureDataAdapter {
    async setupPre(opts) {
        const { statusCallback = () => { } } = opts || {};
        const bigwig = new _gmod_bbi__WEBPACK_IMPORTED_MODULE_0__.BigWig({
            filehandle: (0,_jbrowse_core_util_io__WEBPACK_IMPORTED_MODULE_2__.openLocation)(this.getConf('bigWigLocation'), this.pluginManager),
        });
        const header = await (0,_jbrowse_core_util__WEBPACK_IMPORTED_MODULE_3__.updateStatus)('Downloading bigwig header', statusCallback, () => bigwig.getHeader(opts));
        return { bigwig, header };
    }
    async setup(opts) {
        if (!this.setupP) {
            this.setupP = this.setupPre(opts).catch(e => {
                this.setupP = undefined;
                throw e;
            });
        }
        return this.setupP;
    }
    async getRefNames(opts) {
        const { header: { refsByName }, } = await this.setup(opts);
        return Object.keys(refsByName);
    }
    async refIdToName(refId) {
        var _a;
        const { header: { refsByNumber }, } = await this.setup();
        return (_a = refsByNumber[refId]) === null || _a === void 0 ? void 0 : _a.name;
    }
    async getGlobalStats(opts) {
        const { header: { totalSummary }, } = await this.setup(opts);
        return (0,_jbrowse_core_util_stats__WEBPACK_IMPORTED_MODULE_5__.rectifyStats)(totalSummary);
    }
    getFeatures(region, opts = {}) {
        const { refName, start, end } = region;
        const { bpPerPx = 0, signal, resolution = 1, statusCallback = () => { }, } = opts;
        return (0,_jbrowse_core_util_rxjs__WEBPACK_IMPORTED_MODULE_4__.ObservableCreate)(async (observer) => {
            statusCallback('Downloading bigwig data');
            const source = this.getConf('source');
            const { bigwig } = await this.setup(opts);
            const feats = await bigwig.getFeatures(refName, start, end, {
                ...opts,
                basesPerSpan: bpPerPx / resolution,
            });
            for (let i = 0; i < feats.length; i++) {
                const data = feats[i];
                if (source) {
                    // @ts-ignore
                    data.source = source;
                }
                const uniqueId = `${source}:${region.refName}:${data.start}-${data.end}`;
                // @ts-ignore
                data.refName = refName;
                data.uniqueId = uniqueId;
                observer.next({
                    // @ts-ignore
                    get: (str) => data[str],
                    id: () => uniqueId,
                    // @ts-ignore
                    toJSON: () => data,
                });
            }
            observer.complete();
        }, signal);
    }
    // always render bigwig instead of calculating a feature density for it
    async estimateRegionsStats(_regions) {
        return { featureDensity: 0 };
    }
    freeResources() { }
}
BigWigAdapter.capabilities = [
    'hasResolution',
    'hasLocalStats',
    'hasGlobalStats',
];
//# sourceMappingURL=BigWigAdapter.js.map

/***/ }),

/***/ "?f1ee":
/*!*****************************!*\
  !*** ./localFile (ignored) ***!
  \*****************************/
/***/ (function() {

/* (ignored) */

/***/ })

}]);
//# sourceMappingURL=node_modules_jbrowse_plugin-wiggle_esm_BigWigAdapter_BigWigAdapter_js.bundle.js.map