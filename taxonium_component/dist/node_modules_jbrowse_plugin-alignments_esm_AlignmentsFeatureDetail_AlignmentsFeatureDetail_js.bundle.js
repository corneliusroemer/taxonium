"use strict";
(self["webpackChunktaxonium"] = self["webpackChunktaxonium"] || []).push([["node_modules_jbrowse_plugin-alignments_esm_AlignmentsFeatureDetail_AlignmentsFeatureDetail_js"],{

/***/ "./node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/AlignmentsFeatureDetail.js":
/*!********************************************************************************************************!*\
  !*** ./node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/AlignmentsFeatureDetail.js ***!
  \********************************************************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/FormGroup/FormGroup.js");
/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/FormControlLabel/FormControlLabel.js");
/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Checkbox/Checkbox.js");
/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Typography/Typography.js");
/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Link/Link.js");
/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Paper/Paper.js");
/* harmony import */ var tss_react_mui__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tss-react/mui */ "./node_modules/tss-react/mui.js");
/* harmony import */ var mobx_react__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! mobx-react */ "./node_modules/mobx-react/dist/mobxreact.esm.js");
/* harmony import */ var _jbrowse_core_util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @jbrowse/core/util */ "./node_modules/@jbrowse/core/util/index.js");
/* harmony import */ var _jbrowse_core_util__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_jbrowse_core_util__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var copy_to_clipboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! copy-to-clipboard */ "./node_modules/copy-to-clipboard/index.js");
/* harmony import */ var copy_to_clipboard__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(copy_to_clipboard__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _jbrowse_core_BaseFeatureWidget_BaseFeatureDetail__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @jbrowse/core/BaseFeatureWidget/BaseFeatureDetail */ "./node_modules/@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail.js");
/* harmony import */ var _jbrowse_core_BaseFeatureWidget_BaseFeatureDetail__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_jbrowse_core_BaseFeatureWidget_BaseFeatureDetail__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _BamAdapter_MismatchParser__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../BamAdapter/MismatchParser */ "./node_modules/@jbrowse/plugin-alignments/esm/BamAdapter/MismatchParser.js");








const useStyles = (0,tss_react_mui__WEBPACK_IMPORTED_MODULE_1__.makeStyles)()(() => ({
    compact: {
        paddingRight: 0,
        paddingTop: 0,
        paddingBottom: 0,
    },
}));
const omit = ['clipPos', 'flags'];
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function AlignmentFlags(props) {
    const { classes } = useStyles();
    const { feature } = props;
    const { flags } = feature;
    const flagNames = [
        'read paired',
        'read mapped in proper pair',
        'read unmapped',
        'mate unmapped',
        'read reverse strand',
        'mate reverse strand',
        'first in pair',
        'second in pair',
        'not primary alignment',
        'read fails platform/vendor quality checks',
        'read is PCR or optical duplicate',
        'supplementary alignment',
    ];
    return (react__WEBPACK_IMPORTED_MODULE_0__.createElement(_jbrowse_core_BaseFeatureWidget_BaseFeatureDetail__WEBPACK_IMPORTED_MODULE_4__.BaseCard, { ...props, title: "Flags" },
        react__WEBPACK_IMPORTED_MODULE_0__.createElement(_jbrowse_core_BaseFeatureWidget_BaseFeatureDetail__WEBPACK_IMPORTED_MODULE_4__.SimpleValue, { name: 'Flag', value: flags }),
        react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_6__["default"], null, flagNames.map((name, index) => {
            const val = flags & (1 << index);
            const key = `${name}_${val}`;
            return (react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_7__["default"], { key: key, control: react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_8__["default"], { className: classes.compact, checked: Boolean(val), name: name, readOnly: true }), label: name }));
        }))));
}
function Formatter({ value }) {
    const [show, setShow] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
    const [copied, setCopied] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
    const display = String(value);
    if (display.length > 100) {
        return (react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment, null,
            react__WEBPACK_IMPORTED_MODULE_0__.createElement("button", { type: "button", onClick: () => {
                    copy_to_clipboard__WEBPACK_IMPORTED_MODULE_3___default()(display);
                    setCopied(true);
                    setTimeout(() => {
                        setCopied(false);
                    }, 700);
                } }, copied ? 'Copied to clipboard' : 'Copy'),
            react__WEBPACK_IMPORTED_MODULE_0__.createElement("button", { type: "button", onClick: () => setShow(val => !val) }, show ? 'Show less' : 'Show more'),
            react__WEBPACK_IMPORTED_MODULE_0__.createElement("div", null, show ? display : `${display.slice(0, 100)}...`)));
    }
    return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div", null, display);
}
// utility function to get length of alignment from cigar
function getLengthOnRef(cigar) {
    const cigarOps = (0,_BamAdapter_MismatchParser__WEBPACK_IMPORTED_MODULE_5__.parseCigar)(cigar);
    let lengthOnRef = 0;
    for (let i = 0; i < cigarOps.length; i += 2) {
        const len = +cigarOps[i];
        const op = cigarOps[i + 1];
        if (op !== 'H' && op !== 'S' && op !== 'I') {
            lengthOnRef += len;
        }
    }
    return lengthOnRef;
}
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function SupplementaryAlignments(props) {
    const { tag, model } = props;
    const session = (0,_jbrowse_core_util__WEBPACK_IMPORTED_MODULE_2__.getSession)(model);
    return (react__WEBPACK_IMPORTED_MODULE_0__.createElement(_jbrowse_core_BaseFeatureWidget_BaseFeatureDetail__WEBPACK_IMPORTED_MODULE_4__.BaseCard, { ...props, title: "Supplementary alignments" },
        react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_9__["default"], null, "List of supplementary alignment locations"),
        react__WEBPACK_IMPORTED_MODULE_0__.createElement("ul", null, tag
            .split(';')
            .filter(SA => !!SA)
            .map((SA, index) => {
            const [saRef, saStart, saStrand, saCigar] = SA.split(',');
            const saLength = getLengthOnRef(saCigar);
            const extra = Math.floor(saLength / 5);
            const start = +saStart;
            const end = +saStart + saLength;
            const locString = `${saRef}:${Math.max(1, start - extra)}-${end + extra}`;
            const displayStart = start.toLocaleString('en-US');
            const displayEnd = end.toLocaleString('en-US');
            const displayString = `${saRef}:${displayStart}-${displayEnd} (${saStrand})`;
            return (react__WEBPACK_IMPORTED_MODULE_0__.createElement("li", { key: `${locString}-${index}` },
                react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_10__["default"], { onClick: event => {
                        event.preventDefault();
                        const { view } = model;
                        try {
                            if (view) {
                                view.navToLocString(locString);
                            }
                            else {
                                throw new Error('No view associated with this view anymore');
                            }
                        }
                        catch (e) {
                            console.error(e);
                            session.notify(`${e}`);
                        }
                    }, href: "#" }, displayString)));
        }))));
}
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function PairLink({ locString, model }) {
    const session = (0,_jbrowse_core_util__WEBPACK_IMPORTED_MODULE_2__.getSession)(model);
    return (react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_10__["default"], { onClick: () => {
            const { view } = model;
            try {
                if (view) {
                    view.navToLocString(locString);
                }
                else {
                    session.notify('No view associated with this feature detail panel anymore', 'warning');
                }
            }
            catch (e) {
                console.error(e);
                session.notify(`${e}`);
            }
        }, href: "#" }, locString));
}
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function AlignmentFeatureDetails(props) {
    const { model } = props;
    const feat = JSON.parse(JSON.stringify(model.featureData));
    const SA = (feat.tags && feat.tags.SA) || feat.SA;
    return (react__WEBPACK_IMPORTED_MODULE_0__.createElement(_mui_material__WEBPACK_IMPORTED_MODULE_11__["default"], { "data-testid": "alignment-side-drawer" },
        react__WEBPACK_IMPORTED_MODULE_0__.createElement(_jbrowse_core_BaseFeatureWidget_BaseFeatureDetail__WEBPACK_IMPORTED_MODULE_4__.FeatureDetails, { ...props, omit: omit, feature: feat, formatter: (value, key) => {
                return key === 'next_segment_position' ? (react__WEBPACK_IMPORTED_MODULE_0__.createElement(PairLink, { model: model, locString: value })) : (react__WEBPACK_IMPORTED_MODULE_0__.createElement(Formatter, { value: value }));
            } }),
        SA ? react__WEBPACK_IMPORTED_MODULE_0__.createElement(SupplementaryAlignments, { model: model, tag: SA }) : null,
        react__WEBPACK_IMPORTED_MODULE_0__.createElement(AlignmentFlags, { feature: feat, ...props })));
}
/* harmony default export */ __webpack_exports__["default"] = ((0,mobx_react__WEBPACK_IMPORTED_MODULE_12__.observer)(AlignmentFeatureDetails));
//# sourceMappingURL=AlignmentsFeatureDetail.js.map

/***/ })

}]);
//# sourceMappingURL=node_modules_jbrowse_plugin-alignments_esm_AlignmentsFeatureDetail_AlignmentsFeatureDetail_js.bundle.js.map